<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Attendance Calendar</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .control-group label {
            font-weight: 600;
            font-size: 0.9em;
        }

        select, input, button {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
        }

        select, input {
            background: rgba(255,255,255,0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        select option {
            background: #333;
            color: white;
        }

        input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        button {
            background: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .main-content {
            padding: 30px;
        }

        .student-management {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .student-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .student-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            animation: slideIn 0.3s ease;
            position: relative;
        }

        .student-tag.cse { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .student-tag.mechanical { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .student-tag.electrical { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .student-tag.civil { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .student-tag.it { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .student-tag.ece { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; }

        .branch-badge {
            background: rgba(255,255,255,0.3);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        .remove-student {
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .calendar-header {
            background: linear-gradient(135deg, #ff7eb3 0%, #ff758c 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calendar-nav {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .calendar-nav:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .day-header {
            background: #f0f0f0;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid #e0e0e0;
        }

        .calendar-day {
            min-height: 120px;
            border: 1px solid #e0e0e0;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: white;
        }

        .calendar-day:hover {
            background: #f8f9ff;
            transform: scale(1.02);
            z-index: 1;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .calendar-day.other-month {
            background: #f9f9f9;
            color: #ccc;
        }

        .calendar-day.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .day-number {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .attendance-info {
            font-size: 12px;
            background: rgba(0,0,0,0.1);
            padding: 4px 8px;
            border-radius: 15px;
            margin-top: 5px;
            text-align: center;
        }

        .attendance-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .attendance-modal {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .student-attendance-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .attendance-status {
            display: flex;
            gap: 10px;
        }

        .status-btn {
            padding: 5px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .status-btn.present {
            background: #4CAF50;
            color: white;
        }

        .status-btn.absent {
            background: #f44336;
            color: white;
        }

        .status-btn.active {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .close-modal {
            background: #666;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
        }

        .download-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .download-btn.pdf {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2em; }
            .controls { flex-direction: column; align-items: center; }
            .calendar-day { min-height: 80px; }
            .day-number { font-size: 14px; }
            .modal-buttons { flex-direction: column; }
        }

        .footer {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📚 Student Attendance Calendar</h1>
            <div class="controls">
                <div class="control-group">
                    <label>Month</label>
                    <select id="monthSelect"></select>
                </div>
                <div class="control-group">
                    <label>Year</label>
                    <select id="yearSelect"></select>
                </div>
                <div class="control-group">
                    <label>Branch</label>
                    <select id="branchSelect">
                        <option value="all">All Branches</option>
                        <option value="CSE">CSE</option>
                        <option value="Mechanical">Mechanical</option>
                        <option value="Electrical">Electrical</option>
                        <option value="Civil">Civil</option>
                        <option value="IT">IT</option>
                        <option value="ECE">ECE</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Add Student</label>
                    <input type="text" id="studentName" placeholder="Enter student name">
                </div>
                <div class="control-group">
                    <label>Student Branch</label>
                    <select id="studentBranch">
                        <option value="CSE">CSE</option>
                        <option value="Mechanical">Mechanical</option>
                        <option value="Electrical">Electrical</option>
                        <option value="Civil">Civil</option>
                        <option value="IT">IT</option>
                        <option value="ECE">ECE</option>
                    </select>
                </div>
                <button onclick="addStudent()">Add Student</button>
                <button onclick="downloadStudentListPDF()" class="download-btn pdf">📄 Download Student List PDF</button>
                <button onclick="openTakeAttendancePanel()" class="download-btn" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">✅ Take Attendance</button>
            </div>
        </div>

        <div class="main-content">
            <div class="student-management">
                <h3>👥 Students in Class</h3>
                <div id="branchStats" style="margin-bottom: 15px; font-size: 14px; color: #666;"></div>
                <div class="student-list" id="studentList"></div>
            </div>

            <div class="calendar-container">
                <div class="calendar-header">
                    <button class="calendar-nav" onclick="previousMonth()">‹</button>
                    <h2 id="currentMonth"></h2>
                    <button class="calendar-nav" onclick="nextMonth()">›</button>
                </div>
                <div class="calendar-grid">
                    <div class="day-header">Sun</div>
                    <div class="day-header">Mon</div>
                    <div class="day-header">Tue</div>
                    <div class="day-header">Wed</div>
                    <div class="day-header">Thu</div>
                    <div class="day-header">Fri</div>
                    <div class="day-header">Sat</div>
                    <div id="calendarDays"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="attendance-panel" id="attendancePanel">
        <div class="attendance-modal">
            <h3 id="attendanceDate"></h3>
            <div id="attendanceList"></div>
            <div class="modal-buttons">
                <button class="download-btn" onclick="downloadPresentStudents()">📥 Download Present Students (CSV)</button>
                <button class="download-btn pdf" onclick="downloadPresentStudentsPDF()">📄 Download Present Students (PDF)</button>
                <button class="download-btn" onclick="downloadAllAttendance()">📊 Download All Attendance (CSV)</button>
                <button class="download-btn pdf" onclick="downloadAllAttendancePDF()">📊 Download All Attendance (PDF)</button>
                <button class="close-modal" onclick="closeAttendancePanel()">Close</button>
            </div>
        </div>
    </div>

    <!-- Take Attendance Panel -->
    <div class="attendance-panel" id="takeAttendancePanel">
        <div class="attendance-modal">
            <h3>✅ Take Attendance for Today</h3>
            <div style="margin-bottom: 20px; padding: 15px; background: #f0f8ff; border-radius: 8px;">
                <p><strong>Date:</strong> <span id="todayDate"></span></p>
                <p><strong>Branch:</strong> <span id="todayBranch"></span></p>
                <p><strong>Total Students:</strong> <span id="todayTotal">0</span></p>
            </div>
            <div style="margin-bottom: 20px;">
                <button class="download-btn" onclick="markAllPresent()" style="background: #27ae60; margin-right: 10px;">✅ Mark All Present</button>
                <button class="download-btn" onclick="markAllAbsent()" style="background: #e74c3c;">❌ Mark All Absent</button>
                <button class="download-btn" onclick="resetAllAttendance()" style="background: #95a5a6;">🔄 Reset All</button>
            </div>
            <div id="takeAttendanceList"></div>
            <div class="modal-buttons">
                <button class="download-btn" onclick="saveTodayAttendance()">💾 Save Attendance</button>
                <button class="download-btn pdf" onclick="downloadTodayAttendancePDF()">📄 Download Today's PDF</button>
                <button class="close-modal" onclick="closeTakeAttendancePanel()">Close</button>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>&copy; Made by Golu Gupta & Deepak Yadav & Nitesh Maurya</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        let currentDate = new Date();
        let students = [
            {name: 'Krish kumar  ROLL NO. 1', branch: 'CSE'},
            {name: 'Nitin patele ROLL NO. 2', branch: 'CSE'},
            {name: 'Sager kumar ROLL NO. 3', branch: 'CSE'},
            {name: 'Vivek kumar ROLL NO. 4', branch: 'CSE'},
            {name:'Raju kumar ROLL NO. 5',branch:'CSE'},
            {name:'Priyansu raj chauhan ROLL NO. 6',branch:'CSE'},
            {name:'Golu kumar ROLL NO. 7',branch:'CSE'},
            {name:'Shree ram kumar ROLL NO. 8',branch:'Mechanical'},
            {name:'shivshankar kumar ROLL NO. 9',branch:'Electrical'},
            {name:'Abhiram kumar ROLL NO. 10',branch:'Mechanical'},
            {name:'Nitesh kumar ROLL NO. 11',branch:'CSE'},
            {name:'Ganesh kumar ROLL NO. 12',branch:'CSE'},
            {name:'Pratham prasoon ROLL NO. 13',branch:'CSE'},
            {name:'MD Azhar alam ROLL NO.14 ',branch:'CSE'},
            {name:'Kundan kumar ROLL NO.15 ',branch:'CSE'},
            {name:'Niraj kumar ROLL NO.16 ',branch:'Mechanical'},
            {name:'Aditaya aryan ROLL NO.17 ',branch:'Mechanical'},
            {name:'Yas raj  ROLL NO. 18',branch:'CSE'},
            {name:'Deepak kumar ROLL NO.19 ',branch:'CSE'},
            {name:'Shivam kumar(1) ROLL NO.20 ',branch:'CSE'},
            {name:'shivam kumar ROLL NO.21 ',branch:'Civil'},
            {name:'Rustam kumar ROLL NO.22 ',branch:'CSE'},
            {name:'Masum ali ROLL NO. 23',branch:'Mechanical'},
            {name:'Aadarshini shrivastava ROLL NO.24 ',branch:'CSE'},
        ];
        let attendanceData = {};
        let currentSelectedDate = null;
        let currentBranch = 'all';
        let tempAttendanceData = {}; // For storing temporary attendance data in take attendance mode

        const months = ['January', 'February', 'March', 'April', 'May', 'June',
                       'July', 'August', 'September', 'October', 'November', 'December'];

        function initializeCalendar() {
            populateSelectors();
            setupBranchFilter();
            updateStudentList();
            updateCalendar();
        }

        function populateSelectors() {
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            
            monthSelect.innerHTML = '';
            yearSelect.innerHTML = '';
            
            months.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = month;
                option.selected = index === currentDate.getMonth();
                monthSelect.appendChild(option);
            });
            
            const currentYear = new Date().getFullYear();
            for (let year = currentYear - 2; year <= currentYear + 5; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                option.selected = year === currentDate.getFullYear();
                yearSelect.appendChild(option);
            }
            
            monthSelect.addEventListener('change', (e) => {
                currentDate.setMonth(parseInt(e.target.value));
                updateCalendar();
            });
            
            yearSelect.addEventListener('change', (e) => {
                currentDate.setFullYear(parseInt(e.target.value));
                updateCalendar();
            });
        }

        function setupBranchFilter() {
            const branchSelect = document.getElementById('branchSelect');
            branchSelect.addEventListener('change', (e) => {
                currentBranch = e.target.value;
                updateStudentList();
                updateCalendar();
            });
        }

        function addStudent() {
            const nameInput = document.getElementById('studentName');
            const branchSelect = document.getElementById('studentBranch');
            const name = nameInput.value.trim();
            const branch = branchSelect.value;
            
            if (name && !students.some(student => student.name === name)) {
                students.push({name: name, branch: branch});
                updateStudentList();
                nameInput.value = '';
            }
        }

        function removeStudent(name) {
            students = students.filter(student => student.name !== name);
            updateStudentList();
        }

        function getFilteredStudents() {
            if (currentBranch === 'all') {
                return students;
            }
            return students.filter(student => student.branch === currentBranch);
        }

        function updateStudentList() {
            const studentList = document.getElementById('studentList');
            const branchStats = document.getElementById('branchStats');
            const filteredStudents = getFilteredStudents();
            
            studentList.innerHTML = '';
            
            if (currentBranch === 'all') {
                const branchCounts = {};
                students.forEach(student => {
                    branchCounts[student.branch] = (branchCounts[student.branch] || 0) + 1;
                });
                const statsText = Object.entries(branchCounts)
                    .map(([branch, count]) => `${branch}: ${count}`)
                    .join(' | ');
                branchStats.innerHTML = `Total Students: ${students.length} (${statsText})`;
            } else {
                branchStats.innerHTML = `${currentBranch} Students: ${filteredStudents.length} | Total Students: ${students.length}`;
            }
            
            filteredStudents.forEach(student => {
                const tag = document.createElement('div');
                tag.className = `student-tag ${student.branch.toLowerCase()}`;
                tag.innerHTML = `
                    <span>${student.name}</span>
                    <span class="branch-badge">${student.branch}</span>
                    <button class="remove-student" onclick="removeStudent('${student.name}')">×</button>
                `;
                studentList.appendChild(tag);
            });
        }

        function updateCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('currentMonth').textContent = `${months[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                if (date.getMonth() !== month) {
                    dayElement.classList.add('other-month');
                }
                
                const dateStr = formatDate(date);
                const attendance = attendanceData[dateStr];
                
                let attendanceInfo = '';
                if (attendance) {
                    const filteredStudents = getFilteredStudents();
                    const present = filteredStudents.filter(student => attendance[student.name] === 'present').length;
                    const total = filteredStudents.length;
                    if (total > 0) {
                        attendanceInfo = `<div class="attendance-info">${present}/${total} present</div>`;
                    }
                }
                
                dayElement.innerHTML = `
                    <div class="day-number">${date.getDate()}</div>
                    ${attendanceInfo}
                `;
                
                dayElement.addEventListener('click', () => openAttendancePanel(date));
                calendarDays.appendChild(dayElement);
            }
        }

        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function openAttendancePanel(date) {
            const dateStr = formatDate(date);
            currentSelectedDate = dateStr;
            const filteredStudents = getFilteredStudents();
            
            let branchText = currentBranch === 'all' ? 'All Branches' : currentBranch + ' Branch';
            document.getElementById('attendanceDate').textContent = 
                `Attendance for ${date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })} - ${branchText}`;
            
            const attendanceList = document.getElementById('attendanceList');
            attendanceList.innerHTML = '';
            
            filteredStudents.forEach(student => {
                const item = document.createElement('div');
                item.className = 'student-attendance-item';
                
                const currentStatus = attendanceData[dateStr] ? attendanceData[dateStr][student.name] : null;
                
                item.innerHTML = `
                    <span>${student.name} <small style="color: #666;">(${student.branch})</small></span>
                    <div class="attendance-status">
                        <button class="status-btn present ${currentStatus === 'present' ? 'active' : ''}" 
                                onclick="setAttendance('${dateStr}', '${student.name}', 'present')">
                            ✓ Present
                        </button>
                        <button class="status-btn absent ${currentStatus === 'absent' ? 'active' : ''}" 
                                onclick="setAttendance('${dateStr}', '${student.name}', 'absent')">
                            ✗ Absent
                        </button>
                    </div>
                `;
                attendanceList.appendChild(item);
            });
            
            document.getElementById('attendancePanel').style.display = 'flex';
        }

        function setAttendance(dateStr, student, status) {
            if (!attendanceData[dateStr]) {
                attendanceData[dateStr] = {};
            }
            attendanceData[dateStr][student] = status;
            
            const buttons = document.querySelectorAll(`[onclick*="${student}"]`);
            buttons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick="setAttendance('${dateStr}', '${student}', '${status}')"]`)
                    .classList.add('active');
            
            updateCalendar();
        }

        function closeAttendancePanel() {
            document.getElementById('attendancePanel').style.display = 'none';
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            document.getElementById('monthSelect').value = currentDate.getMonth();
            document.getElementById('yearSelect').value = currentDate.getFullYear();
            updateCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            document.getElementById('monthSelect').value = currentDate.getMonth();
            document.getElementById('yearSelect').value = currentDate.getFullYear();
            updateCalendar();
        }

        // Take Attendance Functions
        function openTakeAttendancePanel() {
            const today = new Date();
            const todayStr = formatDate(today);
            const filteredStudents = getFilteredStudents();
            
            // Initialize temp attendance data
            tempAttendanceData = {};
            
            // Load existing attendance if available
            if (attendanceData[todayStr]) {
                filteredStudents.forEach(student => {
                    if (attendanceData[todayStr][student.name]) {
                        tempAttendanceData[student.name] = attendanceData[todayStr][student.name];
                    }
                });
            }
            
            // Update UI
            document.getElementById('todayDate').textContent = today.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            document.getElementById('todayBranch').textContent = currentBranch === 'all' ? 'All Branches' : currentBranch + ' Branch';
            document.getElementById('todayTotal').textContent = filteredStudents.length;
            
            updateTakeAttendanceList();
            document.getElementById('takeAttendancePanel').style.display = 'flex';
        }

        function updateTakeAttendanceList() {
            const takeAttendanceList = document.getElementById('takeAttendanceList');
            const filteredStudents = getFilteredStudents();
            
            takeAttendanceList.innerHTML = '';
            
            filteredStudents.forEach(student => {
                const item = document.createElement('div');
                item.className = 'student-attendance-item';
                
                const currentStatus = tempAttendanceData[student.name] || null;
                
                item.innerHTML = `
                    <span>${student.name} <small style="color: #666;">(${student.branch})</small></span>
                    <div class="attendance-status">
                        <button class="status-btn present ${currentStatus === 'present' ? 'active' : ''}" 
                                onclick="setTempAttendance('${student.name}', 'present')">
                            ✓ Present
                        </button>
                        <button class="status-btn absent ${currentStatus === 'absent' ? 'active' : ''}" 
                                onclick="setTempAttendance('${student.name}', 'absent')">
                            ✗ Absent
                        </button>
                    </div>
                `;
                takeAttendanceList.appendChild(item);
            });
        }

        function setTempAttendance(student, status) {
            tempAttendanceData[student] = status;
            
            // Update button states
            const buttons = document.querySelectorAll(`[onclick*="'${student}'"]`);
            buttons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick="setTempAttendance('${student}', '${status}')"]`)
                    .classList.add('active');
        }

        function markAllPresent() {
            const filteredStudents = getFilteredStudents();
            filteredStudents.forEach(student => {
                tempAttendanceData[student.name] = 'present';
            });
            updateTakeAttendanceList();
        }

        function markAllAbsent() {
            const filteredStudents = getFilteredStudents();
            filteredStudents.forEach(student => {
                tempAttendanceData[student.name] = 'absent';
            });
            updateTakeAttendanceList();
        }

        function resetAllAttendance() {
            tempAttendanceData = {};
            updateTakeAttendanceList();
        }

        function saveTodayAttendance() {
            const today = new Date();
            const todayStr = formatDate(today);
            
            if (!attendanceData[todayStr]) {
                attendanceData[todayStr] = {};
            }
            
            // Save temp data to main attendance data
            Object.keys(tempAttendanceData).forEach(studentName => {
                attendanceData[todayStr][studentName] = tempAttendanceData[studentName];
            });
            
            updateCalendar();
            alert('Attendance saved successfully!');
        }

        function closeTakeAttendancePanel() {
            document.getElementById('takeAttendancePanel').style.display = 'none';
        }

        function downloadTodayAttendancePDF() {
            const today = new Date();
            const filteredStudents = getFilteredStudents();
            const presentStudents = filteredStudents.filter(student => tempAttendanceData[student.name] === 'present');
            const absentStudents = filteredStudents.filter(student => tempAttendanceData[student.name] === 'absent');
            const notMarked = filteredStudents.filter(student => !tempAttendanceData[student.name]);
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const formattedDate = today.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            let branchText = currentBranch === 'all' ? 'All Branches' : currentBranch + ' Branch';
            
            // Title
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('Today\'s Attendance Report', 20, 20);
            
            // Date and Branch Info
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`Date: ${formattedDate}`, 20, 35);
            doc.text(`Branch: ${branchText}`, 20, 45);
            
            // Summary
            doc.text(`Total Students: ${filteredStudents.length}`, 20, 60);
            doc.text(`Present: ${presentStudents.length}`, 20, 70);
            doc.text(`Absent: ${absentStudents.length}`, 20, 80);
            doc.text(`Not Marked: ${notMarked.length}`, 20, 90);
            
            let y = 110;
            
            // Present Students
            if (presentStudents.length > 0) {
                doc.setFont('helvetica', 'bold');
                doc.text('PRESENT STUDENTS:', 20, y);
                y += 15;
                doc.setFont('helvetica', 'normal');
                
                presentStudents.forEach((student, index) => {
                    if (y > 280) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.text(`${index + 1}. ${student.name} (${student.branch})`, 25, y);
                    y += 10;
                });
            }
            
            // Absent Students
            if (absentStudents.length > 0) {
                y += 10;
                if (y > 260) {
                    doc.addPage();
                    y = 20;
                }
                doc.setFont('helvetica', 'bold');
                doc.text('ABSENT STUDENTS:', 20, y);
                y += 15;
                doc.setFont('helvetica', 'normal');
                
                absentStudents.forEach((student, index) => {
                    if (y > 280) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.text(`${index + 1}. ${student.name} (${student.branch})`, 25, y);
                    y += 10;
                });
            }
            
            // Not Marked Students
            if (notMarked.length > 0) {
                y += 10;
                if (y > 260) {
                    doc.addPage();
                    y = 20;
                }
                doc.setFont('helvetica', 'bold');
                doc.text('NOT MARKED:', 20, y);
                y += 15;
                doc.setFont('helvetica', 'normal');
                
                notMarked.forEach((student, index) => {
                    if (y > 280) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.text(`${index + 1}. ${student.name} (${student.branch})`, 25, y);
                    y += 10;
                });
            }
            
            doc.save(`Today_Attendance_${currentBranch}_${formatDate(today)}.pdf`);
        }

        // PDF Download Functions
        function downloadPresentStudentsPDF() {
            if (!currentSelectedDate) return;
            
            const attendance = attendanceData[currentSelectedDate];
            if (!attendance) {
                alert('No attendance data for this date!');
                return;
            }
            
            const filteredStudents = getFilteredStudents();
            const presentStudents = filteredStudents.filter(student => attendance[student.name] === 'present');
            const absentStudents = filteredStudents.filter(student => attendance[student.name] === 'absent');
            const notMarked = filteredStudents.filter(student => !attendance[student.name]);
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const date = new Date(currentSelectedDate);
            const formattedDate = date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            let branchText = currentBranch === 'all' ? 'All Branches' : currentBranch + ' Branch';
            
            // Title
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('Attendance Report', 20, 20);
            
            // Date and Branch Info
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`Date: ${formattedDate}`, 20, 35);
            doc.text(`Branch: ${branchText}`, 20, 45);
            
            // Summary
            doc.text(`Total Students: ${filteredStudents.length}`, 20, 60);
            doc.text(`Present: ${presentStudents.length}`, 20, 70);
            doc.text(`Absent: ${absentStudents.length}`, 20, 80);
            doc.text(`Not Marked: ${notMarked.length}`, 20, 90);
            
            let y = 110;
            
            // Present Students
            if (presentStudents.length > 0) {
                doc.setFont('helvetica', 'bold');
                doc.text('PRESENT STUDENTS:', 20, y);
                y += 15;
                doc.setFont('helvetica', 'normal');
                
                presentStudents.forEach((student, index) => {
                    if (y > 280) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.text(`${index + 1}. ${student.name} (${student.branch})`, 25, y);
                    y += 10;
                });
            }
            
            // Absent Students
            if (absentStudents.length > 0) {
                y += 10;
                if (y > 260) {
                    doc.addPage();
                    y = 20;
                }
                doc.setFont('helvetica', 'bold');
                doc.text('ABSENT STUDENTS:', 20, y);
                y += 15;
                doc.setFont('helvetica', 'normal');
                
                absentStudents.forEach((student, index) => {
                    if (y > 280) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.text(`${index + 1}. ${student.name} (${student.branch})`, 25, y);
                    y += 10;
                });
            }
            
            // Not Marked Students
            if (notMarked.length > 0) {
                y += 10;
                if (y > 260) {
                    doc.addPage();
                    y = 20;
                }
                doc.setFont('helvetica', 'bold');
                doc.text('NOT MARKED:', 20, y);
                y += 15;
                doc.setFont('helvetica', 'normal');
                
                notMarked.forEach((student, index) => {
                    if (y > 280) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.text(`${index + 1}. ${student.name} (${student.branch})`, 25, y);
                    y += 10;
                });
            }
            
            doc.save(`Attendance_${currentBranch}_${currentSelectedDate}.pdf`);
        }

        function downloadAllAttendancePDF() {
            if (Object.keys(attendanceData).length === 0) {
                alert('No attendance data available to download!');
                return;
            }
            
            const filteredStudents = getFilteredStudents();
            let branchText = currentBranch === 'all' ? 'All Branches' : currentBranch + ' Branch';
            const dates = Object.keys(attendanceData).sort();
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Title
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('Complete Attendance Report', 20, 20);
            
            // Branch Info
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`Branch: ${branchText}`, 20, 35);
            doc.text(`Total Students: ${filteredStudents.length}`, 20, 45);
            doc.text(`Report Generated: ${new Date().toLocaleDateString('en-US')}`, 20, 55);
            
            let y = 75;
            
            // Summary Statistics
            doc.setFont('helvetica', 'bold');
            doc.text('ATTENDANCE SUMMARY:', 20, y);
            y += 15;
            doc.setFont('helvetica', 'normal');
            
            dates.forEach(date => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                const attendance = attendanceData[date];
                const present = filteredStudents.filter(student => attendance[student.name] === 'present').length;
                const absent = filteredStudents.filter(student => attendance[student.name] === 'absent').length;
                const notMarked = filteredStudents.length - present - absent;
                const formattedDate = new Date(date).toLocaleDateString('en-US');
                
                doc.text(`${formattedDate}: Present: ${present}, Absent: ${absent}, Not Marked: ${notMarked}`, 25, y);
                y += 10;
            });
            
            // Individual Student Records
            y += 20;
            if (y > 250) {
                doc.addPage();
                y = 20;
            }
            
            doc.setFont('helvetica', 'bold');
            doc.text('INDIVIDUAL ATTENDANCE RECORDS:', 20, y);
            y += 15;
            
            filteredStudents.forEach(student => {
                if (y > 260) {
                    doc.addPage();
                    y = 20;
                }
                
                doc.setFont('helvetica', 'bold');
                doc.text(`${student.name} (${student.branch}):`, 25, y);
                y += 10;
                doc.setFont('helvetica', 'normal');
                
                let attendanceRecord = dates.map(date => {
                    const status = attendanceData[date] && attendanceData[date][student.name];
                    const formattedDate = new Date(date).toLocaleDateString('en-US');
                    return `${formattedDate}: ${status === 'present' ? 'P' : status === 'absent' ? 'A' : '-'}`;
                }).join(', ');
                
                // Split long attendance records into multiple lines
                const maxLineLength = 80;
                while (attendanceRecord.length > 0) {
                    if (y > 280) {
                        doc.addPage();
                        y = 20;
                    }
                    let line = attendanceRecord.substring(0, maxLineLength);
                    if (attendanceRecord.length > maxLineLength) {
                        const lastComma = line.lastIndexOf(',');
                        if (lastComma > 0) {
                            line = line.substring(0, lastComma);
                        }
                    }
                    doc.text(line, 30, y);
                    attendanceRecord = attendanceRecord.substring(line.length);
                    if (attendanceRecord.startsWith(', ')) {
                        attendanceRecord = attendanceRecord.substring(2);
                    }
                    y += 8;
                }
                y += 5;
            });
            
            doc.save(`Complete_Attendance_Report_${currentBranch}.pdf`);
        }

        function downloadStudentListPDF() {
            const filteredStudents = getFilteredStudents();
            let branchText = currentBranch === 'all' ? 'All Branches' : currentBranch + ' Branch';
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Title
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('Student List', 20, 20);
            
            // Branch Info
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`Branch: ${branchText}`, 20, 35);
            doc.text(`Total Students: ${filteredStudents.length}`, 20, 45);
            doc.text(`Generated: ${new Date().toLocaleDateString('en-US')}`, 20, 55);
            
            let y = 75;
            
            // Student List
            doc.setFont('helvetica', 'bold');
            doc.text('STUDENTS:', 20, y);
            y += 15;
            doc.setFont('helvetica', 'normal');
            
            filteredStudents.forEach((student, index) => {
                if (y > 280) {
                    doc.addPage();
                    y = 20;
                }
                doc.text(`${index + 1}. ${student.name} (${student.branch})`, 25, y);
                y += 10;
            });
            
            doc.save(`Student_List_${currentBranch}.pdf`);
        }

        // Event Listeners
        document.getElementById('attendancePanel').addEventListener('click', (e) => {
            if (e.target.id === 'attendancePanel') {
                closeAttendancePanel();
            }
        });

        document.getElementById('takeAttendancePanel').addEventListener('click', (e) => {
            if (e.target.id === 'takeAttendancePanel') {
                closeTakeAttendancePanel();
            }
        });

        document.getElementById('studentName').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addStudent();
            }
        });

        // Initialize the calendar when page loads
        initializeCalendar();
    </script>
</body>
</html>
        }

        // CSV Download Functions
        function downloadPresentStudents() {
            if (!currentSelectedDate) return;
            
            const attendance = attendanceData[currentSelectedDate];
            if (!attendance) {
                alert('No attendance data for this date!');
                return;
            }
            
            const filteredStudents = getFilteredStudents();
            const presentStudents = filteredStudents.filter(student => attendance[student.name] === 'present');
            const absentStudents = filteredStudents.filter(student => attendance[student.name] === 'absent');
            const notMarked = filteredStudents.filter(student => !attendance[student.name]);
            
            const date = new Date(currentSelectedDate);
            const formattedDate = date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            let branchText = currentBranch === 'all' ? 'All Branches' : currentBranch + ' Branch';
            
            let csvContent = `Attendance Report for ${formattedDate} - ${branchText}\n\n`;
            csvContent += `Total Students: ${filteredStudents.length}\n`;
            csvContent += `Present: ${presentStudents.length}\n`;
            csvContent += `Absent: ${absentStudents.length}\n`;
            csvContent += `Not Marked: ${notMarked.length}\n\n`;
            
            csvContent += `PRESENT STUDENTS\n`;
            csvContent += `Serial No.,Student Name,Branch,Status\n`;
            presentStudents.forEach((student, index) => {
                csvContent += `${index + 1},${student.name},${student.branch},Present\n`;
            });
            
            if (absentStudents.length > 0) {
                csvContent += `\nABSENT STUDENTS\n`;
                csvContent += `Serial No.,Student Name,Branch,Status\n`;
                absentStudents.forEach((student, index) => {
                    csvContent += `${index + 1},${student.name},${student.branch},Absent\n`;
                });
            }
            
            if (notMarked.length > 0) {
                csvContent += `\nNOT MARKED\n`;
                csvContent += `Serial No.,Student Name,Branch,Status\n`;
                notMarked.forEach((student, index) => {
                    csvContent += `${index + 1},${student.name},${student.branch},Not Marked\n`;
                });
            }
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Attendance_${currentBranch}_${currentSelectedDate}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function downloadAllAttendance() {
            if (Object.keys(attendanceData).length === 0) {
                alert('No attendance data available to download!');
                return;
            }
            
            const filteredStudents = getFilteredStudents();
            let branchText = currentBranch === 'all' ? 'All Branches' : currentBranch + ' Branch';
            
            let csvContent = `Complete Attendance Report - ${branchText}\n\n`;
            csvContent += `Student Name,Branch,`;
            
            const dates = Object.keys(attendanceData).sort();
            csvContent += dates.map(date => {
                const formattedDate = new Date(date).toLocaleDateString('en-US');
                return formattedDate;
            }).join(',') + '\n';
            
            filteredStudents.forEach(student => {
                csvContent += `${student.name},${student.branch},`;
                csvContent += dates.map(date => {
                    const status = attendanceData[date] && attendanceData[date][student.name];
                    return status === 'present' ? 'P' : status === 'absent' ? 'A' : '-';
                }).join(',') + '\n';
            });
            
            csvContent += '\n\nSUMMARY STATISTICS\n';
            csvContent += 'Date,Total Present,Total Absent,Not Marked\n';
            
            dates.forEach(date => {
                const attendance = attendanceData[date];
                const present = filteredStudents.filter(student => attendance[student.name] === 'present').length;
                const absent = filteredStudents.filter(student => attendance[student.name] === 'absent').length;
                const notMarked = filteredStudents.length - present - absent;
                const formattedDate = new Date(date).toLocaleDateString('en-US');
                csvContent += `${formattedDate},${present},${absent},${notMarked}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Complete_Attendance_Report_${currentBranch}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Take Attendance Functions
        function openTakeAttendancePanel() {
            const today = new Date();
            const todayStr = formatDate(today);
            const filteredStudents = getFilteredStudents();
            
            // Initialize temp attendance data
            tempAttendanceData = {};
            
            // Load existing attendance if available
            if (attendanceData[todayStr]) {
                filteredStudents.forEach(student => {
                    if (attendanceData[todayStr][student.name]) {
                        tempAttendanceData[student.name] = attendanceData[todayStr][student.name];
                    }
                });
            }
            
            // Update UI
            document.getElementById('todayDate').textContent = today.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            document.getElementById('todayBranch').textContent = currentBranch === 'all' ? 'All Branches' : currentBranch + ' Branch';
            document.getElementById('todayTotal').textContent = filteredStudents.length;
            
            updateTakeAttendanceList();
            document.getElementById('takeAttendancePanel').style.display = 'flex';
        }

        function updateTakeAttendanceList() {
            const takeAttendanceList = document.getElementById('takeAttendanceList');
            const filteredStudents = getFilteredStudents();
            
            takeAttendanceList.innerHTML = '';
            
            filteredStudents.forEach(student => {
                const item = document.createElement('div');
                item.className = 'student-attendance-item';
                
                const currentStatus = tempAttendanceData[student.name] || null;
                
                item.innerHTML = `
                    <span>${student.name} <small style="color: #666;">(${student.branch})</small></span>
                    <div class="attendance-status">
                        <button class="status-btn present ${currentStatus === 'present' ? 'active' : ''}" 
                                onclick="setTempAttendance('${student.name}', 'present')">
                            ✓ Present
                        </button>
                        <button class="status-btn absent ${currentStatus === 'absent' ? 'active' : ''}" 
                                onclick="setTempAttendance('${student.name}', 'absent')">
                            ✗ Absent
                        </button>
                    </div>
                `;
                takeAttendanceList.appendChild(item);
            });
        }

        function setTempAttendance(student, status) {
            tempAttendanceData[student] = status;
            
            // Update button states
            const buttons = document.querySelectorAll(`[onclick*="'${student}'"]`);
            buttons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick="setTempAttendance('${student}', '${status}')"]`)
                    .classList.add('active');
        }

        function markAllPresent() {
            const filteredStudents = getFilteredStudents();
            filteredStudents.forEach(student => {
                tempAttendanceData[student.name] = 'present';
            });
            updateTakeAttendanceList();
        }

        function markAllAbsent() {
            const filteredStudents = getFilteredStudents();
            filteredStudents.forEach(student => {
                tempAttendanceData[student.name] = 'absent';
            });
            updateTakeAttendanceList();
        }

        function resetAllAttendance() {
            tempAttendanceData = {};
            updateTakeAttendanceList();
        }

        function saveTodayAttendance() {
            const today = new Date();
            const todayStr = formatDate(today);
            
            if (!attendanceData[todayStr]) {
                attendanceData[todayStr] = {};
            }
            
            // Save temp data to main attendance data
            Object.keys(tempAttendanceData).forEach(studentName => {
                attendanceData[todayStr][studentName] = tempAttendanceData[studentName];
            });
            
            updateCalendar();
            alert('Attendance saved successfully!');
        }

        function closeTakeAttendancePanel() {
            document.getElementById('takeAttendancePanel').style.display = 'none';
        }

        function downloadTodayAttendancePDF() {
            const today = new Date();
            const filteredStudents = getFilteredStudents();
            const presentStudents = filteredStudents.filter(student => tempAttendanceData[student.name] === 'present');
            const absentStudents = filteredStudents.filter(student => tempAttendanceData[student.name] === 'absent');
            const notMarked = filteredStudents.filter(student => !tempAttendanceData[student.name]);
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const formattedDate = today.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            let branchText = currentBranch === 'all' ? 'All Branches' : currentBranch + ' Branch';
            
            // Title
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('Today\'s Attendance Report', 20, 20);
            
            // Date and Branch Info
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`Date: ${formattedDate}`, 20, 35);
            doc.text(`Branch: ${branchText}`, 20, 45);
            
            // Summary
            doc.text(`Total Students: ${filteredStudents.length}`, 20, 60);
            doc.text(`Present: ${presentStudents.length}`, 20, 70);
            doc.text(`Absent: ${absentStudents.length}`, 20, 80);
            doc.text(`Not Marked: ${notMarked.length}`, 20, 90);
            
            let y = 110;
            
            // Present Students
            if (presentStudents.length > 0) {
                doc.setFont('helvetica', 'bold');
                doc.text('PRESENT STUDENTS:', 20, y);
                y += 15;
                doc.setFont('helvetica', 'normal');
                
                presentStudents.forEach((student, index) => {
                    if (y > 280) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.text(`${index + 1}. ${student.name} (${student.branch})`, 25, y);
                    y += 10;
                });
            }
            
            // Absent Students
            if (absentStudents.length > 0) {
                y += 10;
                if (y > 260) {
                    doc.addPage();
                    y = 20;
                }
                doc.setFont('helvetica', 'bold');
                doc.text('ABSENT STUDENTS:', 20, y);
                y += 15;
                doc.setFont('helvetica', 'normal');
                
                absentStudents.forEach((student, index) => {
                    if (y > 280) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.text(`${index + 1}. ${student.name} (${student.branch})`, 25, y);
                    y += 10;
                });
            }
            
            // Not Marked Students
            if (notMarked.length > 0) {
                y += 10;
                if (y > 260) {
                    doc.addPage();
                    y = 20;
                }
                doc.setFont('helvetica', 'bold');
                doc.text('NOT MARKED:', 20, y);
                y += 15;
                doc.setFont('helvetica', 'normal');
                
                notMarked.forEach((student, index) => {
                    if (y > 280) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.text(`${index + 1}. ${student.name} (${student.branch})`, 25, y);
                    y += 10;
                });
            }
            

            doc.save(`Today_Attendance_${currentBranch}_${formatDate(today)}.pdf`);
